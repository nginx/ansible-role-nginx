---

# Install NGINX package
- name: "(Install: FreeBSD) Install NGINX port"
  portinstall:
    name: "{{ nginx_freebsd_package }}"
    state: present
  register: result
  retries: "{{ nginx_install_retries }}"
  until: result is succeeded
  delay: "{{ nginx_install_delay }}"
  notify: "(Handler: All OSs) Start NGINX"
  when: nginx_freebsd_install_method|lower == 'ports'

- name: "(Install: FreeBSD) Install NGINX package"
  pkgng:
    name: "{{ nginx_freebsd_package }}"
    state: present
  register: result
  retries: "{{ nginx_install_retries }}"
  until: result is succeeded
  delay: "{{ nginx_install_delay }}"
  notify: "(Handler: All OSs) Start NGINX"
  when: nginx_freebsd_install_method|lower == 'packages'

# Install NGINX extra packages
- name: "(Install: FreeBSD) Install NGINX extra ports"
  portinstall:
    name: "{{ item }}"
    state: present
  register: result
  retries: "{{ nginx_install_retries }}"
  until: result is succeeded
  delay: "{{ nginx_install_delay }}"
  loop: "{{ nginx_freebsd_extra_packages }}"
  notify: "(Handler: All OSs) Start NGINX"
  when: nginx_freebsd_install_method|lower == 'ports'

- name: "(Install: FreeBSD) Install NGINX packages"
  pkgng:
    name: "{{ nginx_freebsd_extra_packages }}"
    state: present
  register: result
  retries: "{{ nginx_install_retries }}"
  until: result is succeeded
  delay: "{{ nginx_install_delay }}"
  notify: "(Handler: All OSs) Start NGINX"
  when: nginx_freebsd_install_method|lower == 'packages'

# Configure RC
- name: "(Install: FreeBSD) Enable and start nginx."
  lineinfile:
    dest: /etc/rc.conf
    regexp: "^nginx_enable"
    line: "nginx_enable=\"YES\""
    backup: "{{ nginx_conf_backup }}"
  notify: "(Handler: All OSs) Start NGINX"
  when: nginx_enable

- name: "(Install: FreeBSD) Disable and stop nginx."
  lineinfile:
    dest: /etc/rc.conf
    regexp: "^nginx_enable"
    line: "nginx_enable=\"NO\""
    backup: "{{ nginx_conf_backup }}"
  notify: "(Handler: All OSs) Stop and Disable NGINX"
  when: not nginx_enable

- name: "(Install: FreeBSD) variables in rc.conf"
  lineinfile:
    dest: /etc/rc.conf
    regexp: "^{{ item.key }}"
    line: "{{ item.key }}={{ item.val }}"
    backup: "{{ nginx_conf_backup }}"
  loop: "{{ nginx_freebsd_rcconf }}"
  notify: "(Handler: All OSs) Reload NGINX"
  when: nginx_enable
